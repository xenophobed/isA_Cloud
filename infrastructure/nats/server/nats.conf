# NATS Server Configuration for isA_Cloud
# Main server configuration with JetStream enabled

# Server identification
server_name: "isa-cloud-nats-1"
listen: 0.0.0.0:4222

# HTTP monitoring
http_port: 8222

# Cluster configuration
cluster {
  name: "isa-cloud-cluster"
  listen: 0.0.0.0:6222
  
  # Routes to other nodes (for 3-node cluster)
  routes: [
    nats-route://nats-2:6222
    nats-route://nats-3:6222
  ]
}

# JetStream configuration
jetstream {
  store_dir: "/data/jetstream"
  
  # Maximum memory storage (1GB)
  max_memory_store: 1073741824
  
  # Maximum file storage (10GB)
  max_file_store: 10737418240
}

# Logging
debug: false
trace: false
logtime: true
log_file: "/var/log/nats/nats.log"

# Authorization (basic setup for development)
authorization {
  default_permissions {
    publish: ">"
    subscribe: ">"
  }
  
  users: [
    {
      user: "isa_cloud_admin"
      password: "admin123"
      permissions {
        publish: ">"
        subscribe: ">"
      }
    },
    {
      user: "isa_user_service"
      password: "service123"
      permissions {
        publish: [
          "events.>", "commands.>", "notifications.>",
          "$JS.API.>", "$JS.ACK.>", "$JS.FC.>"
        ]
        subscribe: [
          "events.>", "commands.>", "notifications.>", 
          "_INBOX.>", "$JS.API.>", "$JS.ACK.>", "$JS.FC.>"
        ]
      }
    }
  ]
}

# System account for internal operations (removed to fix startup issue)
# system_account: "SYS"

# Limits
max_connections: 10000
max_control_line: 4096
max_payload: 1048576  # 1MB
max_pending: 67108864  # 64MB

# Ping interval
ping_interval: "2m"
ping_max: 2

# TLS Configuration (disabled for development, enable for production)
# tls {
#   cert_file: "/etc/nats/certs/server-cert.pem"
#   key_file: "/etc/nats/certs/server-key.pem"
#   ca_file: "/etc/nats/certs/ca.pem"
#   verify: true
# }